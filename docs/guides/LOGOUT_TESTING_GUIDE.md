# ?? ?????? ???? Logout - ???? ?????

## ?? ??????? ????????

- ? Backend ???? ???: `https://localhost:7001`
- ? ???? token ???? ??????? ?? ??????
- ? Postman ?? ?? ???? ??????? APIs

---

## ?? ?????? 1: Logout ???????

### 1. ???? ??? Token ?????
```http
POST https://localhost:7001/api/auth/login
Content-Type: application/json

{
  "email": "doctor@example.com",
  "password": "YourPassword123!"
}
```

**?????? ???????:**
```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "role": "Doctor",
  "userId": 5
}
```

### 2. ?????? Logout
```http
POST https://localhost:7001/api/doctor/logout
Authorization: Bearer {token_from_step_1}
```

**?????? ???????:**
```json
{
  "success": true,
  "message": "?? ????? ?????? ?????",
  "messageEn": "Logged out successfully",
  "user": {
    "userId": 5,
    "userName": "Dr. Ahmed Mohamed"
  }
}
```

### 3. ???? ?? ??? ?????? ??? ?????? ??? Logout
```http
GET https://localhost:7001/api/doctor/dashboard
Authorization: Bearer {same_token}
```

**?????? ???????:**
```json
401 Unauthorized
(?? ?? ???? ??? ?? ??? ????? token blacklist)
```

---

## ?? ?????? 2: Logout ??????

### 1. ????? ???? ?????
```http
POST https://localhost:7001/api/auth/login
Content-Type: application/json

{
  "email": "patient@example.com",
  "password": "YourPassword123!"
}
```

### 2. ?????? Logout
```http
POST https://localhost:7001/api/user/logout
Authorization: Bearer {patient_token}
```

**?????? ???????:**
```json
{
  "success": true,
  "message": "?? ????? ?????? ?????",
  "messageEn": "Logged out successfully",
  "user": {
    "userId": 12,
    "userName": "Ahmed Hassan"
  }
}
```

---

## ?? ?????? 3: ????? ?????

### Test Case 1: ???? Authorization Header
```http
POST https://localhost:7001/api/doctor/logout
(no headers)
```

**?????? ???????:**
```
401 Unauthorized
```

### Test Case 2: Token ??? ????
```http
POST https://localhost:7001/api/doctor/logout
Authorization: Bearer invalid_token_here
```

**?????? ???????:**
```
401 Unauthorized
```

### Test Case 3: ??????? Patient Token ??? Doctor Endpoint
```http
POST https://localhost:7001/api/doctor/logout
Authorization: Bearer {patient_token}
```

**?????? ???????:**
```
403 Forbidden
```

### Test Case 4: ??????? Doctor Token ??? Patient Endpoint
```http
POST https://localhost:7001/api/user/logout
Authorization: Bearer {doctor_token}
```

**?????? ???????:**
```
403 Forbidden
```

---

## ?? Postman Collection

### ????? Collection ?????

1. **???? Postman**
2. **???? Collection ????? "PulseX Logout Tests"**
3. **??? ?????????:**
   - `baseUrl`: `https://localhost:7001`
   - `doctorToken`: (???? ???? ??? Login)
   - `patientToken`: (???? ???? ??? Login)

### Requests:

#### 1. Doctor Login
```
POST {{baseUrl}}/api/auth/login
Body (raw JSON):
{
  "email": "doctor@example.com",
  "password": "YourPassword123!"
}

Tests Script:
pm.environment.set("doctorToken", pm.response.json().token);
```

#### 2. Doctor Logout
```
POST {{baseUrl}}/api/doctor/logout
Headers:
  Authorization: Bearer {{doctorToken}}
```

#### 3. Patient Login
```
POST {{baseUrl}}/api/auth/login
Body (raw JSON):
{
  "email": "patient@example.com",
  "password": "YourPassword123!"
}

Tests Script:
pm.environment.set("patientToken", pm.response.json().token);
```

#### 4. Patient Logout
```
POST {{baseUrl}}/api/user/logout
Headers:
  Authorization: Bearer {{patientToken}}
```

---

## ?? cURL Commands ???????? ??????

### Doctor Logout:
```bash
# 1. Login
curl -X POST https://localhost:7001/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"doctor@example.com","password":"YourPassword123!"}'

# 2. Logout (?????? ??? token ?? ?????? ???????)
curl -X POST https://localhost:7001/api/doctor/logout \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```

### Patient Logout:
```bash
# 1. Login
curl -X POST https://localhost:7001/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"patient@example.com","password":"YourPassword123!"}'

# 2. Logout
curl -X POST https://localhost:7001/api/user/logout \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```

---

## ? Checklist ????????

### Backend Tests:
- [ ] Doctor logout ???? ?????
- [ ] Patient logout ???? ?????
- [ ] ??? ??????? ???? token
- [ ] ??? token ??? ????
- [ ] ??? ??????? wrong role token
- [ ] ????? ????? ????? ??????
- [ ] Status codes ????? (200, 401, 403)

### Response Validation:
- [ ] `success` field ?????
- [ ] `message` ??????? ?????
- [ ] `messageEn` ?????????? ?????
- [ ] `user.userId` ?????
- [ ] `user.userName` ?????

### Error Handling:
- [ ] 401 ??? unauthorized requests
- [ ] 403 ??? wrong role
- [ ] 400 ??? general errors
- [ ] Error messages ??????

---

## ?? ????? ???????? ????????

| Test Case | Expected Status | Expected Response |
|-----------|----------------|-------------------|
| Doctor Logout (Valid) | 200 OK | success: true |
| Patient Logout (Valid) | 200 OK | success: true |
| No Token | 401 | Unauthorized |
| Invalid Token | 401 | Unauthorized |
| Wrong Role | 403 | Forbidden |

---

## ?? ??????? ??????? (Troubleshooting)

### ????? 1: 401 Unauthorized ??????
**????:**
- ???? ?? ???? ??? token ?? Header
- ???? ?? ?????? ??? token (?? ?????)
- ???? ?? ???? ??? Bearer token ?????

### ????? 2: 403 Forbidden
**????:**
- ???? ?? ??????? ??? role ??????
- Doctor token ? /api/doctor/logout
- Patient token ? /api/user/logout

### ????? 3: SSL Certificate Error
**????:**
```bash
# ?? Postman
Settings ? Disable SSL certificate verification

# ?? cURL
curl -k https://localhost:7001/api/doctor/logout ...
```

---

## ?? Quick Test Script

```bash
#!/bin/bash

echo "=== Testing PulseX Logout System ==="

# Variables
BASE_URL="https://localhost:7001"
DOCTOR_EMAIL="doctor@example.com"
DOCTOR_PASSWORD="YourPassword123!"

echo "\n1. Testing Doctor Login..."
LOGIN_RESPONSE=$(curl -s -X POST "$BASE_URL/api/auth/login" \
  -H "Content-Type: application/json" \
  -d "{\"email\":\"$DOCTOR_EMAIL\",\"password\":\"$DOCTOR_PASSWORD\"}")

TOKEN=$(echo $LOGIN_RESPONSE | jq -r '.token')

echo "Token: $TOKEN"

echo "\n2. Testing Doctor Logout..."
LOGOUT_RESPONSE=$(curl -s -X POST "$BASE_URL/api/doctor/logout" \
  -H "Authorization: Bearer $TOKEN")

echo $LOGOUT_RESPONSE | jq '.'

echo "\n=== Test Complete ==="
```

---

## ?? ??? ?????

??? ??? ?? ??????:
1. ???? ?? Logs ?? Backend
2. ???? ?? Database connection
3. ???? ?? JWT secret key ???? ?? appsettings
4. ???? ??? Startup.cs ?????? ?? configuration

---

? **???? ????????!**
