# ?? ?????? ??????? - ???? ?????? ???????

## ?? **???????**

**??????:**
- **???????**: ????? ????? ?? ?????? ???????? (First Name + Last Name)
- **????? ????????**: ????? ????? ?? ???? ???? (FullName)
- **??????**: ??????? ???? ????? ?? ??? ????? Database

---

## ? **????**

### **????????????:**
1. ? ????????? ?? ?? ?? (????? migration)
2. ? ??? DTOs ???? ??????? ??????
3. ? ??? Service ?????? ????????
4. ? ??? ???? ???????? ?????? ????

---

## ?? **???????**

### **1. ????? Registration DTOs**

#### **?????? (RegisterPatientDto)**
```csharp
[JsonPropertyName("first_name")]
public string FirstName { get; set; }

[JsonPropertyName("last_name")]
public string LastName { get; set; }

// Helper property (????? ??????? ????????)
[JsonIgnore]
public string FullName => $"{FirstName} {LastName}".Trim();
```

#### **??????? (CreateDoctorDto)**
```csharp
public string FirstName { get; set; }
public string LastName { get; set; }

[JsonIgnore]
public string FullName => $"{FirstName} {LastName}".Trim();
```

#### **?????? (CreateAdminDto)**
```csharp
public string FirstName { get; set; }
public string LastName { get; set; }

[JsonIgnore]
public string FullName => $"{FirstName} {LastName}".Trim();
```

---

### **2. ????? Response (LoginResponseDto)**

```csharp
public class LoginResponseDto
{
    [JsonPropertyName("first_name")]
    public string FirstName { get; set; }    // ? ???? ?????
    
    [JsonPropertyName("last_name")]
    public string LastName { get; set; }     // ? ???? ?????
    
    [JsonPropertyName("full_name")]
    public string FullName { get; set; }     // ? ???????
}
```

---

### **3. Helper Class (NameHelper)**

```csharp
public static class NameHelper
{
    // ???? ?????
    public static (string FirstName, string LastName) SplitFullName(string fullName)
    {
        var parts = fullName.Trim().Split(' ', 2);
        return (parts[0], parts.Length > 1 ? parts[1] : "");
    }

    // ???? ?????
    public static string CombineNames(string firstName, string lastName)
    {
        return $"{firstName?.Trim()} {lastName?.Trim()}".Trim();
    }
}
```

---

### **4. ??????? ?? AuthService**

#### **???????:**
```csharp
// ? ??????? FullName ??????? ????????
var user = new User
{
    FullName = dto.FullName,  // ???? FirstName + LastName
    // ...
};

await _userRepository.AddAsync(user);

// ? ??? ???? Response? ??????? ????
var (firstName, lastName) = NameHelper.SplitFullName(user.FullName);

return new LoginResponseDto
{
    FirstName = firstName,
    LastName = lastName,
    FullName = user.FullName
};
```

#### **????? ??????:**
```csharp
var user = await _userRepository.GetByEmailAsync(dto.Email);

// ? ????? ????? ?? ?????????
var (firstName, lastName) = NameHelper.SplitFullName(user.FullName);

return new LoginResponseDto
{
    FirstName = firstName,    // "????"
    LastName = lastName,      // "???"
    FullName = user.FullName  // "???? ???"
};
```

---

## ?? **??? Flow ??????**

```
??????? ???                     ????? ???                    ?????????
???????????                    ??????????                   ?????????

[First Name: "????"]  ???
[Last Name: "???"]     ???>  DTO (??????) ??> Service ??> Users.FullName
                         ?    FirstName + LastName           = "???? ???"
                         ??????????????????????????????????????????????

                                                                    ?
                                                                    ?
??? ????????           <???? Response <???? (??????) <????? "???? ???"
First Name: "????"
Last Name: "???"
Full Name: "???? ???"
```

---

## ?? **????????**

### **Test 1: ????? ????**

**Request:**
```json
POST /api/auth/register
{
  "first_name": "????",
  "last_name": "???",
  "email": "ahmed@example.com",
  "password": "SecurePass123!",
  "phone_number": "+201234567890",
  "gender": "Male",
  "date_of_birth": "1985-06-15"
}
```

**Response:**
```json
{
  "first_name": "????",
  "last_name": "???",
  "full_name": "???? ???",
  "role": "Patient"
}
```

**?? Database:**
```sql
SELECT FullName FROM Users WHERE Email = 'ahmed@example.com';
-- ???????: "???? ???"
```

---

### **Test 2: ????? ????**

**Request:**
```json
POST /api/auth/login
{
  "email": "ahmed@example.com",
  "password": "SecurePass123!"
}
```

**Response:**
```json
{
  "first_name": "????",      // ? ?????
  "last_name": "???",        // ? ?????
  "full_name": "???? ???"   // ? ????
}
```

---

## ?? **????????**

### ? **????? ????? ?? Database**
- Schema ?? ?? ??
- ????? Downtime
- ????? Scripts ???????

### ? **????? ??????? ???**
- ????? ??????? ??????
- ????????? ???????
- ??? Full Name ???????

### ? **Clean Architecture**
- DTOs: ??????? ?? Interface
- Service: ??????? ?? Logic
- Database: ????? ???? ??????

### ? **?????? ??? ???????**
- Patient ?
- Doctor ?
- Admin ?

---

## ?? **Checklist**

- [?] RegisterPatientDto ????
- [?] CreateDoctorDto ????
- [?] CreateAdminDto ????
- [?] LoginResponseDto ????
- [?] NameHelper ?????
- [?] AuthService ????
- [?] AdminService (?? ?? ?????)
- [?] Build ????
- [?] ???? ????????

---

## ?? **??????? ???**

### **????? ????????:**
```javascript
const data = {
  first_name: "????",
  last_name: "???",
  email: "ahmed@example.com",
  // ...
};

fetch('/api/auth/register', {
  method: 'POST',
  body: JSON.stringify(data)
});
```

### **??????? Response:**
```javascript
const response = await fetch('/api/auth/login', ...);
const data = await response.json();

console.log(data.first_name);  // "????"
console.log(data.last_name);   // "???"
console.log(data.full_name);   // "???? ???"
```

---

## ? **???????**

???? ?? ????? **architecture ????** ????:
- ? ????? Database
- ? Migration Scripts
- ? Breaking Changes

**??????:** ? **???? ????? 100%**
