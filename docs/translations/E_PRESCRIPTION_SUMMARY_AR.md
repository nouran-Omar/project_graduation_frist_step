# ? ???? ???? ???????? ??????????? (E-Prescription System)

##  ??????: ?? ??????? ??????? ?

---

## ?? ???? ????

?? ????? ???? ???????? ??????????? ???????. ?????? ???? ??????? ?????? ?????? ?????? ????? ?????? ???????? ???????? ??????.

---

## ?? ??????? ???????

### ? 1. ??????? ?????? (Navigation Logic)

#### ??????? ??????: Direct Context (????? ?? ??????? ??????)
- ????? ???? ??????? ??? "Add Prescription" ?? ???? ???? ????
- ?????? ?????? ????? ???????? (Auto-filled)
- ?????? ?????? ??????? (Read-only)

#### ??????? ???????: General Access (?? ??????? ????????)
- ????? ???? ??????? ??? "Prescription" ?? ??????? ????????
- ???? Search Bar ????? ?? ??????
- ???? ????? ?????? ?? ??? ?????? (Patient ID)

### ? 2. ????? ??????? (4 ????? ??????)

**?. Medication Entry (????? ???????)**
- ??? ?????? (Drug Name)
- ?????? (Dosage)
- ??????? (Frequency)
- ????? (Duration)
- ?? "+ Add More Medication" ?????? ????? ??????

**?. Lab & Radiology Requests (????? ???????? ???????)**
- ??? ???????/?????? (Test/Scan Name)
- ??????? ?????? (Additional Notes)
- ?? "+ Add More Lab/Radiology Request"

**?. Clinical Notes (????????? ???????????)**
- ????? ?? ???? ????????? ??????
- ????? ????????
- ??????? ??? ??????

**?. Action Button (?? ???????)**
- ?? "Send to Patient" ??????
- ???? ??????? ?? ????? ????????
- ?????? ?? PatientId ? AppointmentId
- ???? ????? ???? ??????

### ? 3. ????? ????????

**???? Prescriptions:**
- Id (???? ????)
- DoctorId (???? ??????)
- PatientId (???? ??????)
- AppointmentId (???? ?????? - ???????)
- MedicationsJson (??????? ????? JSON)
- LabRequestsJson (???????? ????? JSON)
- ClinicalNotes (????????? ???????????)
- CreatedAt (????? ???????)
- IsRead (?? ?? ????????)
- ReadAt (????? ???????)

**????? ???? Patients:**
- ????? ??? PatientId (???: PAT001? PAT002)
- ???? ???? (Unique Index) ??? PatientId

### ? 4. API Endpoints (???? ???????)

#### 1. ?????? ??? ?????? ??????? (Direct Context)
```
GET /api/prescriptions/form-data/patient/{patientId}
Authorization: Bearer {token}
Role: Doctor
```

#### 2. ????? ?? ?????? (General Access)
```
GET /api/prescriptions/search-patients?searchTerm=yousra
Authorization: Bearer {token}
Role: Doctor
```

#### 3. ????? ?????? ?????
```
POST /api/prescriptions/create
Authorization: Bearer {token}
Role: Doctor
```

#### 4. ?????? ??? ?????? ?????? (??? ??????)
```
GET /api/prescriptions/my-prescriptions
Authorization: Bearer {token}
Role: Patient
```

#### 5. ?????? ??? ????? ???????
```
GET /api/prescriptions/{prescriptionId}
Authorization: Bearer {token}
Role: Doctor, Patient
```

#### 6. ????? ??????? ???????
```
PUT /api/prescriptions/{prescriptionId}/mark-read
Authorization: Bearer {token}
Role: Patient
```

### ? 5. ???? ?????????

**??? ????? ???????:**
1. ? ??? ??????? ?? ????? ????????
2. ? ????? ??????? ?? ??????? (Logs)
3. ? TODO: ????? ????? ???? ?????? ??????
4. ? TODO: ????? ???? ????????
5. ? TODO: ????? ???? ??????

**?? ??????? ????????:**
```
???????: ????? ?????
???????: ?????? ??????? ????? ?? ????? [??? ???????]
```

---

## ?? ??????? ????????

### Backend Files ?

```
Backend/
??? PulseX.Core/
?   ??? Models/
?   ?   ??? Prescription.cs           ? ????
?   ?   ??? Patient.cs                ? ????? ?? PatientId
?   ?   ??? Medication.cs             ? Helper class
?   ??? DTOs/Prescription/
?   ?   ??? PrescriptionDto.cs        ? ???? ??? DTOs
?   ??? Interfaces/
?       ??? IPrescriptionRepository.cs ? ????
?       ??? IPatientRepository.cs      ? ????? ?? ?????
?
??? PulseX.Data/
?   ??? ApplicationDbContext.cs        ? ????? ???????
?   ??? Repositories/
?       ??? PrescriptionRepository.cs  ? ????
?       ??? PatientRepository.cs       ? ????? ?? ?????
?
??? PulseX.API/
    ??? Controllers/
    ?   ??? PrescriptionsController.cs ? ???? ???? ???????
    ??? Services/
        ??? PrescriptionService.cs     ? ??????? ??????
```

---

## ?? ??????? ???????? ???????

### 1. Migration (??????)

??? ????? ????? `Patient` ?????? ??? `PatientId`? ????? ??? ????? Migration:

```bash
cd Backend/PulseX.Data
dotnet ef migrations add AddPatientIdToPatient --startup-project ../PulseX.API
dotnet ef database update --startup-project ../PulseX.API
```

### 2. ??? ?????? PatientId

??? ????? Migration? ??? ??? ??? `PatientId` ?????? ?????????:

```sql
-- ???? ?????? PatientId ????????
UPDATE Patients
SET PatientId = 'PAT' + RIGHT('00000' + CAST(Id AS VARCHAR(5)), 5)
WHERE PatientId IS NULL OR PatientId = '';

-- ???????: PAT00001, PAT00002, ???
```

---

## ?? Frontend Components ????????

### 1. PrescriptionFormPage
```jsx
<PrescriptionForm 
  isDirectContext={isDirectContext}
  prefilledPatient={patientData}
/>
```

### 2. PatientSearchBar
```jsx
<PatientSearch
  onPatientSelect={handlePatientSelect}
  placeholder="Search by name or patient ID"
/>
```

### 3. MedicationEntry
```jsx
<MedicationList
  medications={medications}
  onAdd={handleAddMedication}
  onRemove={handleRemoveMedication}
/>
```

### 4. LabRequestEntry
```jsx
<LabRequestList
  labRequests={labRequests}
  onAdd={handleAddLabRequest}
  onRemove={handleRemoveLabRequest}
/>
```

---

## ?? ?????? ??????

### ??????? 1: Direct Context
```bash
# 1. ???? ??? ?????? ????? ??????
curl -X GET "https://localhost:7001/api/prescriptions/form-data/patient/5" \
  -H "Authorization: Bearer {doctor_token}"

# 2. ???? ???????
curl -X POST "https://localhost:7001/api/prescriptions/create" \
  -H "Authorization: Bearer {doctor_token}" \
  -H "Content-Type: application/json" \
  -d '{
    "patient_id": 5,
    "medications": [{
      "drug_name": "Amoxicillin",
      "dosage": "500mg",
      "frequency": "3 times daily",
      "duration": "7 days"
    }],
    "lab_requests": [{
      "test_name": "CBC",
      "additional_notes": "Fasting required"
    }],
    "clinical_notes": "Take with food"
  }'
```

### ??????? 2: General Access
```bash
# 1. ???? ?? ??????
curl -X GET "https://localhost:7001/api/prescriptions/search-patients?searchTerm=yousra" \
  -H "Authorization: Bearer {doctor_token}"

# 2. ???? ??????? (??? ??????? ?????)
```

### ??????? 3: ?????? ???? ???????
```bash
# ?????? ?????? ???????
curl -X GET "https://localhost:7001/api/prescriptions/my-prescriptions" \
  -H "Authorization: Bearer {patient_token}"
```

---

## ? ?????? ????????

| ?????? | ?????? |
|--------|--------|
| Database Schema | ? ????? |
| Models | ? ???? |
| DTOs | ? ???? |
| Repositories | ? ???? ?? ????? |
| Services | ? ????? ???? |
| Controllers | ? 6 ???? ????? |
| Patient Search | ? ???? |
| Notification Logging | ? ???? |
| Build Status | ? ???? |

---

## ?? ????????

- **6 API Endpoints** ?????
- **4 ?????** ?? ????? ???????
- **2 ?????** ?????? ??? ???????
- **10 ?????** ?????/?????
- **Build Status**: ? ????

---

## ?? ??????? ???????

1. ? ????? Migration ??? PatientId
2. ? ??? ?????? PatientId ?????? ?????????
3. ? ????? Frontend Components
4. ? ????? ???? ????????? ?????? ??????
5. ? ?????? API Endpoints ?? Postman/Swagger
6. ? ????? ???? PDF generation ????????
7. ? ??? ?????? ??????????

---

## ?? ??????? ????

- ? ???? ??????? ?? ???????? ???????? ????? (Build Successful)
- ? ????? ???????? ?????? ??????? ?? `ApplicationDbContext`
- ? ???? ????? ?? ?????? ???? ?????? ?? ??? ??????
- ?? ????? Migration ?????? ??????? PatientId
- ?? ???? ????????? ?????? ???? ?? Logs (????? ????? ???? ????????? ???????)

---

## ?? ?????

??? ????? ?? ?????:
- **??????**: ????
- **???????**: ???? ????? ???? ?????
- **??????**: ???? ??????? ?

---

**??? ?????**: 2 ?????? 2025  
**???? ??????**: ? ???? ???????  
**?????? ???????**: Migration ???? Frontend
