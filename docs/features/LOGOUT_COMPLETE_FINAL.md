# ?? ???? Logout - ??????? ??????? ??????

## ? ???? ???????: **???? ?????? 100%**

?? ?????: $(Get-Date -Format "yyyy-MM-dd HH:mm")

---

## ?? ??????? ????????? ?????????

### Backend Files:

#### 1. **Modified Files:**
- ? `PulseX.API/Controllers/DoctorController.cs` - ????? logout endpoint
- ? `PulseX.API/Controllers/UserController.cs` - ????? logout endpoint

#### 2. **Documentation Files (New):**
- ? `Backend/LOGOUT_SYSTEM_IMPLEMENTATION.md` - ???? ??????? ??????
- ? `Backend/LOGOUT_SUMMARY_AR.md` - ???? ???? ???????
- ? `Backend/LOGOUT_TESTING_GUIDE.md` - ???? ????????
- ? `Backend/LOGOUT_SYSTEM_COMPLETE_GUIDE.md` - ??? ?????

---

## ?? ?? ?? ?????? ??????

### 1?? Logout ??????? (Doctor)

**??????:** `PulseX.API/Controllers/DoctorController.cs`

**API Endpoint:**
```
POST /api/doctor/logout
Authorization: Bearer {token}
```

**?????:**
```csharp
[HttpPost("logout")]
[Authorize(Roles = "Doctor")]
public IActionResult Logout()
{
    var userId = GetUserId();
    var userName = User.FindFirst(ClaimTypes.Name)?.Value;
    
    return Ok(new 
    { 
        success = true,
        message = "?? ????? ?????? ?????",
        messageEn = "Logged out successfully",
        user = new { userId, userName }
    });
}
```

---

### 2?? Logout ?????? (Patient)

**??????:** `PulseX.API/Controllers/UserController.cs`

**API Endpoint:**
```
POST /api/user/logout
Authorization: Bearer {token}
```

**??? ????? ?? ????? Role ??? "Patient"**

---

## ?? ?????????? (API Responses)

### ? Success (200 OK):
```json
{
  "success": true,
  "message": "?? ????? ?????? ?????",
  "messageEn": "Logged out successfully",
  "user": {
    "userId": 5,
    "userName": "Dr. Ahmed"
  }
}
```

### ? Error (400):
```json
{
  "success": false,
  "message": "??? ????? ??????",
  "messageEn": "Logout failed",
  "error": "details"
}
```

---

## ?? Frontend Implementation

### LogoutModal Component:
```jsx
const LogoutModal = ({ isOpen, onClose }) => {
  const navigate = useNavigate();
  const [loading, setLoading] = useState(false);

  const handleLogout = async () => {
    setLoading(true);
    try {
      const token = localStorage.getItem('token');
      const userRole = localStorage.getItem('userRole');
      
      const endpoint = userRole === 'Doctor' 
        ? '/api/doctor/logout' 
        : '/api/user/logout';
      
      await axios.post(
        `${process.env.REACT_APP_API_URL}${endpoint}`,
        {},
        { headers: { 'Authorization': `Bearer ${token}` } }
      );

      localStorage.clear();
      navigate('/login');
    } catch (error) {
      console.error(error);
      alert('??? ???');
    } finally {
      setLoading(false);
    }
  };

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
      <div className="bg-white rounded-lg p-6 max-w-md w-full">
        <h2 className="text-2xl font-bold mb-4">Log Out?</h2>
        <p className="text-gray-600 mb-4">
          Are you sure you want to log out?
        </p>
        <p className="text-sm text-gray-500 mb-6">
          ?? ??? ????? ?? ????? ???????
        </p>
        
        <div className="flex gap-3 justify-end">
          <button onClick={onClose} className="px-6 py-2 border rounded-lg">
            No, Cancel
          </button>
          <button onClick={handleLogout} disabled={loading} 
                  className="px-6 py-2 bg-blue-600 text-white rounded-lg">
            {loading ? 'Logging out...' : 'Yes, Confirm'}
          </button>
        </div>
      </div>
    </div>
  );
};
```

---

## ?? ????????

### Postman:
```
POST https://localhost:7001/api/doctor/logout
Headers: Authorization: Bearer YOUR_TOKEN
```

### cURL:
```bash
curl -X POST https://localhost:7001/api/doctor/logout \
  -H "Authorization: Bearer YOUR_TOKEN"
```

---

## ?? Workflow

```
User clicks Logout
   ?
Modal appears
   ?
User confirms
   ?
API call
   ?
Clear localStorage
   ?
Navigate to /login
```

---

## ? Checklist

### Backend: ? ?????
- [x] Doctor logout endpoint
- [x] Patient logout endpoint
- [x] Authorization
- [x] Error handling
- [x] Documentation
- [x] Build successful

### Frontend: ? ?????
- [ ] LogoutModal component
- [ ] Sidebar integration
- [ ] API integration
- [ ] Testing

---

## ?? ???????

1. **LOGOUT_SYSTEM_IMPLEMENTATION.md** - ???? ????
2. **LOGOUT_SUMMARY_AR.md** - ???? ????
3. **LOGOUT_TESTING_GUIDE.md** - ???? ????????

---

## ?? ??????? ???????

### ??? Frontend:
1. ????? LogoutModal
2. ????? ?? Logout ?? Sidebar
3. ??? API
4. ??????

---

## ?? ?????

- ???? ????? ???????
- ????? ?? Postman ?????
- ???? ?? Logs

---

**??????:** ? **Backend ????? ?????**
**Build Status:** ? **Successful**

?? **???? ?????????!**
